\chapter{ワークA：センサ回路設計}


\section{はじめに}


%% ワークAを理解した上で，目的として要約する
%%
%% （例文）
%%本課題では～を目的とし，～の実験を行った．
%% 実験を通じて～の結果を得た．
%% それらの結果より，～であることを明らかにする．
本課題では，脈拍の測定を目的とし，自身の脈拍を観測する実験を行った．ブレッドボード上に微弱な信号を増幅することで，脈拍を観測できる電気回路を構築した．
しかし，フォトリフレクタで計測する方法では，脈拍とは関係ない信号が検知されてしまう場合がある．そのため，不要な周波数を除外するフィルター回路も実装した．

\section{方法及び手順} 
\subsection{必須課題A-1}
%% ワークAで設計・実装するものを理解した上で，方法や手順に落とし込んだ
%% 形で，客観的に記述する．報告書の基準は，この報告書の記述だけで，第
%% 三者が追試をし，同様の結果を得ることできることである．必要に応じて，
%% 図，表，式を用いて，曖昧な箇所や誤解を生じにくい説明が求められる．


必須課題A-1では，ブレッドボード上にAtomLiteからの信号を-30倍と-3倍する増幅回路を通すことで，全体で90倍できる電気回路を作成する．

増幅率は図\ref{circuit01}を例にとると，増幅率$A$，出力電位$v_i$,出力電位$v_0$とした時に，-90倍は\eqref{amplification01}式,-30倍は\eqref{amplification02}式にて計算ができる．

\begin{equation}
\label{amplification01}
A_{1}=\frac{R_{2}}{R_{5}}=\frac{1.0*10^{6}}{33*10^{3}}=30
\end{equation}

\begin{equation}
\label{amplification02}
A_{2}=\frac{R_{1}}{R_{6}}=\frac{1.0*10^{5}}{33*10^{3}}=3.0
\end{equation}


これに加え,脈拍とは関係のない周波数を除去するために，一定値以上または，一定値以下の周波数は大きく減衰させるために，ローパスフィルター($f_{L}$)とハイパスフィルター($f_{U}$)を作成する．
下限周波数は$f_{L}\simeq 0.48\mathrm{Hz}$とし，上限周波数は$f_{U}\simeq 16\mathrm{Hz}$とする．
下限周波数は\ref{circuit01}を例にとると，\eqref{lowfreqency}式にて計算できる．また，上限周波数は\eqref{highfreqency}式にて計算できる.
\begin{equation}
\label{lowfreqency}
f_{L}=\frac{1}{2\pi C_{3}R_{5}}=\frac{1}{2*3.14*10*10^{-6}*33*10^{3}}=0.48
\end{equation}
\begin{equation}
\label{highfreqency}
f_{U}=\frac{1}{2\pi C_{2}R_{2}}=\frac{1}{2*3.14*0.01*10^{-6}*1.00*10^{6}}=15.9
\end{equation}

これらの条件を満たした抵抗器とコンデンサの値及びに，回路全体で使用する部品は表\ref{value}に記載する．


入力信号はAtom Liteを使用する．ただし，信号を微弱にするために$1M\Omega$の抵抗器を直列で接続する必要がある．
Atom Liteには，緑，赤，青，紫の波形を入力信号として出力させる．
緑は$1\mathrm{Hz}$の低周波正弦波を出力する．赤は，$1\mathrm{Hz}$の低周波正弦波と$100\mathrm{Hz}$の高周波正弦波の合成波を出力する．
青は，$1\mathrm{Hz}$の低周波正弦波と$7\mathrm{Hz}$の高周波正弦波の合成波を出力する．紫は，保存された脈波を出力する．
これらの対応表は表\ref{Atome}に記載する．

A-1で使用する回路図は図\ref{circuit01}である．AtomeLiteからの信号は$V_{i}$と接続する．ブレッドボード上に実装した例は図\ref{circuit02}になる．

\begin{table}[H]\caption{使用する部品}
 \centering
  \begin{tabular}{|c|c|c|}
   \hline
   部品名&仕様&素子変数\\ \hline
   炭素皮膜抵抗&$350\Omega$&$R_3$\\ \hline
   炭素皮膜抵抗&$3.3k\Omega$&$R_4$\\ \hline
   炭素皮膜抵抗&$33k\Omega$&$R_5,R_6,R_7,R_9$\\ \hline
   炭素皮膜抵抗&$1M\Omega$&$R_2$\\ \hline
   炭素皮膜抵抗&$100k\Omega$&$R_1,R_8,R_10$\\ \hline 
   積層セラミックコンデンサ&$10\mu F$&$C_3,C_4$\\ \hline  
   積層セラミックコンデンサ&$0.01\mu F$&$C_2$\\ \hline
   積層セラミックコンデンサ&$0.1\mu F$&$C_1$\\ \hline
   オペアンプ&LM358N& \\ \hline
   フォトリフレクタ&LBR-127HLD& \\ \hline 
  \end{tabular}
  \label{value}
\end{table}

\begin{table}[H]\caption{Atome Liteの出力する波形の対応表}
 \centering
  \begin{tabular}{|c|c|}
   \hline
   色&出力する波形\\ \hline
   緑&低周波正弦波($1\mathrm{Hz}$)\\ \hline
   赤&低周波正弦波($1\mathrm{Hz}$)と高周波正弦波($100\mathrm{Hz}$)\\ \hline
   青&低周波正弦波($1\mathrm{Hz}$)と高周波正弦波($7\mathrm{Hz}$)\\ \hline
   紫&脈波\\ \hline
  \end{tabular}
  \label{Atome}
\end{table}

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.95\textwidth,clip]{fig_work_A/circuit01.png}
\end{center}
\caption{\textgt{必須課題A-1の回路図}}
\label{circuit01}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.95\textwidth,clip]{fig_work_A/circuit02.JPG}
\end{center}
\caption{\textgt{必須課題A-1のブレッドボード上に実装された回路}}
\label{circuit02}
\end{figure}

\subsection{必須課題A-2}
必須課題A-2では，人の脈拍をフォトリフレクタを利用して，リアルタイムでセンシングする回路を作成する．
入力信号をフォトリフレクタから受け取る．フォトリフレクタは赤外線を放出し，人の指に通っている血管内の赤血球に赤外線が衝突した時に反射でフォトトランジスタに入ってきたときに信号を発する．これを脈拍検知に利用する．電気回路はA-1で作成したものえを流用し，ブレッドボード上にAtome Liteを使用していた部分をフォトリフレクタに変更して実装する．使用する部品の仕様等は，表\ref{value}に記載されている．
A-2で実装する回路図は図\ref{circuit03}となる．ブレットボード上に実装した例は図\ref{circuit04}となる．

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.95\textwidth,clip]{fig_work_A/circuit03.png}
\end{center}
\caption{\textgt{必須課題A-2の回路図}}
\label{circuit03}
\end{figure}

\begin{figure}[H]
\begin{center}
\includegraphics[width=0.95\textwidth,clip]{fig_work_A/circuit04.JPG}
\end{center}
\caption{\textgt{必須課題A-2のブレッドボード上に実装された回路}}
\label{circuit04}
\end{figure}





\section{結果} 
%% 実験から得られた結果を，目的や方法を理解した上で，重要データを外す
%% ことなく，要領よくまとめてください．
%% 
%% 結果（数値）は，（自分はポイントを理解しているということをアピール
%% しながら）視認性（一覧性）を高めて報告することが求められる．この意
%% 味で，要領よくまとめられた表が望ましい．決して，文章の中にバラバラ
%% に埋没させて，読み手がどこに書いているか分かりにくい（書き手にとっ
%% ては都合のよい）記載するものではない点に注意する．
%% 
%% 
%% 結果をまとめた表の例
%% ただし，ワーク前の説明で話した通り，
%%   - 一次データ（生データ）
%%   - 計器パラメータ（レンジなど）
%%   - 中間算出値（二次以上の高次データ）
%%   - 周期，時間差，入力電位，出力電位（必須データ）
%%   - 手順書の課題4.で求められるデータ（必須データ）
%% を記録した表に書き換えて，結果報告してください．
\subsection{必須課題A-1}
必須課題A-1では増幅回路を実装し，AtomLiteからの信号を増幅した．実験からオシロスコープを用いて，増幅前の信号と2回増幅した信号の波形に加え，1回のみ増幅した時の波形が確認できた．
オシロスコープにて確認できた波形は，増幅前と増幅後の２つの波形が表示されている．今回は，CH1は増幅前の波形を示し，CH2は増幅後の波形を示している．
オシロスコープからは縦軸の電圧値，横軸の時間，周期，位相のずれ(時間差)が読み取れる．また，この情報から周波数，増幅率を求めることが可能である．
オシロスコープにて確認できた緑の波形は，図\ref{green}である．
\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth,clip]{fig_work_A/green.JPG}
  \caption{AtomLiteからの緑の信号の増幅前と2段増幅後の波形}
  \label{green}
\end{figure}

図\ref{green}からは，横軸が1ブロックあたり200msで表されている．CH1の縦軸は，1ブロックあたり20mVで表されている．一方CH2では，1ブロックあたり200mvで表現されている．
この基準からCH1は，20mVだと読み取れる．CH2は640mVだと読み取れる．これから\eqref{ampgreen}式より増幅率は32倍であることが求められる．

\begin{equation}
  A_{G}=\frac{200*3.2}{20*1}=\frac{640}{20}=32
  \label{ampgreen}
\end{equation}

また，周期は1ブロックあたり200msのため，この波形の周期は680msだと読み取れる．
これから\eqref{greenfrequency}式より周期が$1.47\mathrm{Hz}$であることが求められる．
また，CH1の波形は，CH2の波形よりも20msずれが生じていることが読み取れる．
\begin{equation}
  T=\frac{1}{0.68}=1.47
  \label{greenfrequency}
\end{equation}


オシロスコープにて確認できた赤の波形は，図\ref{red}である．
\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth,clip]{fig_work_A/red.JPG}
  \caption{AtomLiteからの赤の信号の増幅前と2段増幅後の波形}
  \label{red}
\end{figure}

赤の波形では，低周波数と高周波数が合成されている．横軸が1ブロックあたり100msで表されている．低周波数の場合，CH1の縦軸は，1ブロックあたり20mvで表現されている．一方CH2では，1ブロックあたり200mvで表現されている．
この基準から低周波数の場合CH1は，16mVだと読み取れる．CH2は640mVだと読み取れる．これから\eqref{ampred1}式より増幅率は40倍であることが求められる．
また，高周波数の場合，CH1は8mVだと読み取れる．CH2は20mVだと読み取れる．これから\eqref{ampred2}式より増幅率が2.5倍であることが求められる．

\begin{equation}
  A_{L}=\frac{200*3.2}{20*0.8}=\frac{640}{16}=40
  \label{ampred1}
\end{equation}

\begin{equation}
  A_{H}=\frac{200*0.1}{20*0.4}=\frac{20}{8}=2.5
  \label{ampred2}
\end{equation}

周期は1ブロックあたり100msで表現されているため，低周波数の周期は680msだと読み取れる．高周波数の周期は10msだと読み取れる．
よって，低周波数の周波数は\eqref{redfrequency1}式より，$1.47\mathrm{Hz}$と求められる．高周波数の周波数は，\eqref{redfrequency2}式より，$100\mathrm{Hz}$と求められる．
また，低周波数のCH1の波形は，CH2の波形よりも40msずれていることが読み取れる．高周波数ではCH1がCH2よりも5msずれていることが読み取れる．
\begin{equation}
  T_{L}=\frac{1}{0.68}=1.47
  \label{redfrequency1} 
\end{equation}

\begin{equation}
  T_{H}=\frac{1}{0.01}=100
  \label{redfrequency2}
\end{equation}

オシロスコープにて確認できた青の波形は図\ref{blue}である．
\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth,clip]{fig_work_A/blue.JPG}
  \caption{AtomLiteからの青の信号の増幅前と2段増幅後の波形}
  \label{blue}
\end{figure}
青の波形では，低周波数と高周波数が合成されて表示されている．1ブロックあたり縦軸はCH1の場合50mVであり，CH2は500mVで表現されている．
この基準から，低周波数の場合はCH1は20mVだと読み取れる．また，CH2では1000mVだと読み取れる．高周波数の場合はCH1は10mVだと読み取れる．CH2は500mVだと読み取れる．
これから\eqref{ampblue1}式より低周波数の増幅率は，50倍であることが求められる．また，\eqref{ampblue2}式より高周波数の増幅率は50倍であることが求められる．

\begin{equation}
  A_{L}=\frac{500*2.1}{50*0.4}=\frac{1050}{20}=52.5
  \label{ampblue1}
\end{equation}

\begin{equation}
  A_{H}=\frac{500*1}{50*0.2}=\frac{500}{10}=50
  \label{ampblue2}
\end{equation}

横軸は1ブロックあたり200msで表現されているため，低周波数の周期は680msだと読み取れる．高周波数の周期は80msだと読み取れる．
よって，低周波数の周波数は，\eqref{bluefrequency1}式より$1.47\mathrm{Hz}$と求められる．高周波数の周波数は，\eqref{bluefrequency2}式より$12.5\mathrm{Hz}$と求められる．
また，低周波数のCH1の波形はCH2よりも40msずれていることが読み取れる．高周波数のCH1の波形はCH2よりも20msずれていることが読み取れる．
\begin{equation}
  T_{L}=\frac{1}{0.68}=1.47
  \label{bluefrequency1}
\end{equation}

\begin{equation}
  T_{H}=\frac{1}{0.08}=12.5
  \label{bluefrequency2}
\end{equation}

オシロスコープにて確認できた紫の波形は図\ref{perple}である．

\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth,clip]{fig_work_A/perple.JPG}
  \caption{AtomLiteからの紫の信号の増幅前と2段増幅後の波形}
  \label{perple}
\end{figure}

紫の波形は人の脈波が表示されている．1ブロックあたりCH1の縦軸は50mVであり，CH2の縦軸は500mVで表現されている．
この基準からCH1は30mVであり，CH2は2100mVだと読み取れる．
これから\eqref{ampperple}式より増幅率は70倍と求められる．

\begin{equation}
  A=\frac{500*4.2}{50*0.6}=\frac{2100}{30}=70
  \label{ampperple}
\end{equation}

横軸は1ブロックあたり200msで表現されているため，周期が960msと読み取れる．
よって，周波数は\eqref{perplefrequency}式より$1.04\mathrm{Hz}$と求められる．

\begin{equation}
  T=\frac{1}{0.96}=1.04
  \label{perplefrequency}
\end{equation}

これらの実験結果から得られた低周波数の値は表\ref{resultA-1low}に記載する．高周波数の値は表\ref{resultA-1high}に記載する．

\begin{table}[H]\caption{波形出力デバイスの計測結果}
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    &\multicolumn{6}{|c|}{低周波数信号}
    \\
    \hline
    &周期
    &周波数
    &$v_{{i}}$
    &$v_{{o}}$
    &増幅率
    &時間差
    \\[-4pt]
    &[ms]
    &[$\mathrm{Hz}$]
    &[mV]
    &[mV]
    &[倍]
    &[ms]
    \\
    \hline
    波形1&680&1.47&20&640&32&20\\
    \hline
    波形2 &680&1.47&16&640&40&20\\
    \hline
    波形3 &680&1.47&20&1000&52.5&40\\
    \hline
    波形4 &960&1.04&30&2100&70&0\\
    \hline
  \end{tabular}
  \label{resultA-1low}
\end{table}

\begin{table}[H]\caption{波形出力デバイスの計測結果}
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    &\multicolumn{6}{|c|}{高周波数信号}
    \\
    \hline
    &周期
    &周波数
    &$v_{{i}}$
    &$v_{{o}}$
    &増幅率
    &時間差
    \\[-4pt]
    &[ms]
    &[$\mathrm{Hz}$]
    &[mV]
    &[mV]
    &[倍]
    &[ms]
    \\
    \hline
    波形1&-&-&-&-&-&-\\
    \hline
    波形2 &10&100&8&10&2.5&5\\
    \hline
    波形3 &80&12.5&10&500&50&20\\
    \hline
    波形4 &-&-&-&-&-&-\\
    \hline
  \end{tabular}
  \label{resultA-1high}
\end{table}
%% 必ず下記のものは写真を撮るなどして図として報告書に記載してください．
\clearpage
\newpage

\subsection{必須課題A-2}
必須課題A-2では，A-1で実装した増幅回路及びにフィルター回路を利用して，自身の脈波のセンシングを行った．
オシロスコープによって得られた波形は図\ref{mypalse}である．
\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth,clip]{fig_work_A/myself.JPG}
  \caption{フォトリフレクタでセンシングした自身の脈波の増幅前と2段増幅後の波形}
  \label{mypalse}
\end{figure}

横軸は1ブロックあたり200msで表現されているため，周期は600msだと読み取れる．
これより，周波数は\eqref{mypalsefrequency}式より$1.7\mathrm{Hz}$と求められる．

\begin{equation}
  T=\frac{1}{600}=1.7
  \label{mypalsefrequency}
\end{equation}

縦軸はCH1の場合は50mV，CH2は500mVで表現されている．そのため，CH1は35mV，CH2は1500ｍVだと読み取れる．
さらにもう1つの振動は，CH1が20mV，CH2は1450mVだと読み取れる．

増幅率は前者の振動は\ref{ampmypalse_L}式にて42.9倍であることが求められる．後者は\ref{ampmypalse_S}式にて72.5倍であることが求められる．

\begin{equation}
  A_{L}=\frac{1500}{35}=42.9
  \label{ampmypalse_L}
\end{equation}

\begin{equation}
  A_{S}=\frac{1450}{20}=72.5
  \label{ampmypalse_S}
\end{equation}

周波数から1分間の振動数は\eqref{frequencytime}式から求められる．そのため，振動数は1分あたり102回である．

\begin{equation}
  f=1.7*60=102
  \label{frequencytime}
\end{equation}

これらの実験結果から得られた値は表\ref{resultA-2}に記載する．

\begin{table}[H]\caption{波形出力デバイスの計測結果}
  \centering
  \begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    \multicolumn{7}{|c|}{自身の脈波}
    \\
    \hline
    &周期
    &時間差
    &$v_{{i}}$
    &$v_{{o}}$
    &増幅率
    &振動数
    \\[-4pt]
    &[ms]
    &[ms]
    &[mV]
    &[mV]
    &[倍]
    &[回/分]
    \\
    \hline
    最も長い周期の波形&600&10&35&1500&42.9&102\\ \hline
    次に長い周期の波形&600&10&20&1450&72.5&102\\
    \hline
  \end{tabular}
  \label{resultA-2}
\end{table}

\section{考察}
%% 手順書の「４ 考察」であげた３項目を含み，結果（数値）に対する自分の
%% 考えを述べよ．
%% 感想とならないよう，数値に基づいた定量的な考察となるように注意する．

\subsection{増幅率と周波数}
%%必須ワークA-1 で記録した表1.3 に，項目として，増幅率や周波数の項目を追加して，
%%それらの算出した数値に対して考察せよ．
必須課題A-1ではAtomLiteからの信号をオシロスコープにて計測を行い，表\ref{resultA-1low}と表\ref{resultA-1high}に結果をまとめた．
この実験結果から，理論上およそ90倍される回路であるはずだが，どの周波数の波形も90倍されていないことが分かる．
とくに顕著に増幅されていない周波数は波形2の高周波数である．これは増幅回路と同時にハイパスフィルター回路が原因だと考えられる．
ハイパスフィルターでは$15.9\mathrm{Hz}$以上の周波数は大幅に減衰させている．波形2の高周波数は$100\mathrm{Hz}$なので，フィルター回路が正常に働いている影響だと考えられる．
波形3では，低周波数と高周波数のどちらもフィルター回路に影響されないため，どちらの周波数も同じ増幅率で増幅されていると考えられる．

\subsection{脈波の2つの波}
%%必須ワークA-2 で記録した画像（波形）について，最も周期が長い信号と，次に長い信号について，上記考察1. で作成した表を作成し，
%%さらに１分当たりの振動数の項目も追加して，それらの算出した数値に対して考察せよ．

今回A-2にて取得できたデータでは周期の違いはほとんど見られなかった．そのため，1分あたり振動数も変化はほとんどない．
振動数は1分に102回であるため，成人男性の標準値であることが分かるので，A-2の回路は脈拍計として正常に作動していることが分かる．
しかしながら，信号の強度に若干の差が生じた．これは測定誤差だと考えられる．フォトリフレクタに指を置く力のよって指先に流れる血液量が変化すると考えられるからである．
\subsection{CH1とCH2の時差}
%%ワークＡを通じてオシロスコープで表示したvi （ch1: 黄色波形）とvo （ch2: 水色波形）
%%とには時間差が生じている．この時間差を測定し，その原因を考察せよ．
ワークAでは波形の取得した．たいていの波形では時間差が生じている．
反転増幅回路は2回通しているため位相のずれは$2\pi$であるため時間差は発生しないと考えられる．そのため，フィルター回路に原因があると考えられる．
回路には，コンデンサがいくつか利用している．コンデンサには電気を貯蓄する性質があるため，コンデンサが電気を貯蓄する時間と放出する時間が必要である．
そのための時間がCH1とCH2の時間差に表れていると考えられる
\section{おわりに} 
%% ワークAを通じて得られた知見や考察，目的の達成度などについて記述し，ワー
%% クAを総括する．単なる感想ではなく，客観的な総括を行うように注意する．
ワークAでは，ブレッドボード上に脈波のセンシングを行い，その波形を観測する回路を実装した．A-1とA-2の実験を行い，測定器具としてオシロスコープを用いた．
A-1では，AtomeLiteからの信号を分析し，増幅率から反転増幅回路とフィルター回路の動作確認が行えた．
A-2では，自身の脈波をフォトリフレクタを用いてセンシングし，脈波の波形を測定できた．脈波はA-1で行った脈波の波形と似ているため，フォトリフレクタによる脈波の測定は成功したと考えられる．
しかし，ノイズの排除処理が行われていないため，A-1の脈波の波形ほど綺麗に出力されなかった．そのため，ワークBにてノイズの排除について取り組む必要がある．




%\begin{figure}[ht]
%\begin{center}
%\includegraphics[width=0.95\textwidth,clip]{fig_work_A/LBR-127HLD.png}
%\end{center}
%\caption{\textgt{
    %図の内容を表す適切なキャプションをつける
%}}
%\label{sample}
%\end{figure}